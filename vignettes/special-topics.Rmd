---
title: "Special topics"
author: "Carson Sievert & Joe Cheng"
date: "`r Sys.Date()`"
output: 
  rmarkdown::html_vignette:
    self_contained: false
vignette: >
  %\VignetteIndexEntry{3. Special topics}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## tidyeval and shinymeta

Many **tidyverse** function arguments quote their input and evaluate those code expression in some special context (e.g., within a data frame). That's how **dplyr** knows, for example, to evaluate symbols (e.g. `cyl`) and calls (e.g., `mean(mpg)`) within a context defined by `mtcars`:

```{r}
library(tidyverse)

mtcars %>% 
  group_by(cyl) %>% 
  summarise(avg = mean(mpg))
```

This design is great for interactive use, but it also complicates things if we wish to pass variables into these quoted arguments. For example, if we were to program a Shiny app that allowed us to compute the average of diffferent variables, you might use something like `rlang::sym()` (or `as.symbol()`) to turn a string into a symbol this way:

```{r}
input <- list(var = "mpg")
mean_by_cyl <- reactive({
  var_sym <- sym(input$var)
  mtcars %>%
    group_by(cyl) %>% 
    summarise(mean_mpg = mean(!!var_sym))
})
mean_by_cyl()
```

Making the **shinymeta** variant that works 

```{r}
input <- list(var = "mpg")
mean_by_cyl <- metaReactive({
  var_sym <- sym(..(input$var))
  mtcars %>%
    group_by(cyl) %>% 
    summarise(mean_mpg = mean(!!var_sym))
}, bindToReturn = TRUE)
expandChain(mean_by_cyl())
```

TODO: 
 1. Do an example where `input$var` represent a symbol 
 2. Are there any **tidyeval** patterns that totally conflict with **shinymeta**?  


## Capturing setup code

## Meta variants of `observeEvent()`/`eventReactive()`

## Debugging meta-reactives

To debug code that contains `..()`, use `metaExpr()`


## Shiny modules

See example app
